# ADR‑0001 — Accessaurus SDK Architecture (Meta Writer, JSON‑LD, Synonyms)

**Date:** 2025‑09‑05
**Owners:** Sunghyun Cho
**Decision Scope:** B2B “drop‑in” SDK for Next.js/Web that generates (a) SEO meta (title/description/social cards), (b) Schema.org JSON‑LD, and (c) query expansion/synonyms—securely, predictably, and cost‑aware.

## Context & Problem

We need a production‑grade system that lets customers drop a single SDK into a Next.js/Web app and receive:

* **Meta tag writer** at build time (ISR/SSG) or on publish.
* **Schema.org JSON‑LD** blocks (Article/Product/Event/FAQ/HowTo).
* **Synonyms & redirects** for on‑site search (reviewed before going live).

Constraints:

* Multi‑tenant B2B; **no secrets in the browser**.
* Deterministic, **idempotent** generation; avoid re‑charging for trivial edits.
* **Guardrails:** when inputs are incomplete or confidence is low, return `null` (don’t guess).
* Customers want **control** (review UI, brand rules) and **predictable costs**.
* Prevent **key theft** and **billing abuse**; domain alone is not sufficient.

## Decision Summary

We will build **Accessaurus** as a **server‑first, multi‑tenant** platform with:

1. **SDK (server helpers + optional React wrapper)** that computes a **content hash**, calls our **server API** with an **Idempotency‑Key**, and never exposes customer secrets in the browser.
2. **API Gateway** with **HMAC‑signed requests**, optional **ephemeral JWTs** for rare client calls, **domain verification**, **rate limiting**, and **idempotency**.
3. **Ingestion Normalizer** (HTML→safe text, boilerplate stripping, PII redaction) feeding a **Perceptual Hash Layer** (SimHash/MinHash) to skip LLM if edits are trivial.
4. **LLM Gateway** that uses **structured outputs (JSON Schema)**, **low temperature**, and **automatic validation** (AJV + heuristics + confidence scoring). If validation fails → retry; if still low confidence → **return `null`**.
5. **Cache (Redis/KV)** and **Postgres** (tenants, domains, keys, outputs, usage ledger).
6. **Job queue & workers** for on‑publish and ISR/SSG pre‑warming; **review UI** for JSON‑LD & synonyms before activation.
7. **Billing** on **successful, non‑cached generations**, deduped by **Idempotency‑Key/content hash**, with hard/soft budget caps.
