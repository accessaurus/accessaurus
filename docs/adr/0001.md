# ADR‑0001 — Accessaurus Architecture: AI Semantic HTML Transformer

**Date:** 2025‑09‑09
**Owners:** Sunghyun Cho
**Decision Scope:** Server‑first, multi‑tenant SDK + API that upgrades non‑semantic markup into accessible, semantic HTML with conservative heuristics and optional AI assistance.

## Context & Problem

Web apps often ship div/span‑heavy markup and over‑use ARIA roles. This harms accessibility and SEO, and it’s costly to retrofit. Teams need a low‑risk path that keeps visuals intact while improving semantics (landmarks, headings, figures, time, etc.). The system must be predictable, idempotent, and secure.

Constraints:

* Multi‑tenant B2B; no secrets in the browser.
* Deterministic, idempotent processing; avoid recomputation for trivial edits.
* Guardrails: when signals are weak or confidence is low, do not guess—emit suggestions or no‑ops.
* Customers retain control via review UI and policy rules.
* Strong authz: key theft prevention; domain verification alone is insufficient.

## Decision Summary

Accessaurus is a server‑first platform focused on AI‑assisted semantic HTML transformation:

1. SDK (server helpers + optional React wrapper) computes a content hash, calls our server API with an Idempotency‑Key, and never exposes secrets in the browser.
2. API Gateway with HMAC‑signed requests, optional short‑lived JWTs for rare client calls, domain verification, rate limiting, and idempotency.
3. Ingestion Normalizer: HTML→safe text, boilerplate stripping, PII redaction; Perceptual Hash (SimHash/MinHash) to detect trivial edits and skip costly steps.
4. Transformer Core (Heuristics‑first): maps roles/ids/classes to semantic tags (header/nav/main/section/article/aside/footer; figure/figcaption; time; anchor→button when appropriate), produces a change log with reasons and confidence.
5. LLM Gateway (optional): schema‑bounded suggestions (JSON Schema), low temperature, automatic validation (AJV + heuristics + confidence scoring). If validation fails or confidence is low → do not apply.
6. Storage: Cache (Redis/KV) and Postgres (organizations via Clerk org_id, domains, keys, inputs, outputs, change logs, usage ledger).
7. Jobs & Review: queue workers for batch/CI use; review UI to diff & approve changes; export PRs or apply via API.

Adjacent features like metadata and JSON‑LD may be provided by the same SDK, but the primary focus is semantic HTML transformation.

## Architecture (Initial)

- SDK: `semantifyHtml(html, options) -> { html, stats }` with deterministic behavior and content hashing.
- API: `POST /api/semantify` accepts `{ html, options }`, returns `{ html, stats: { changes, counts, totalNodes } }`.
- Heuristics: role/class/id patterns, anchor→button for trivial hrefs, date detection to `<time datetime>`, figure/figcaption detection; conservative defaults.
- Validation: structured outputs for LLM suggestions; AJV + heuristics + thresholds.
- Idempotency: content hash + Idempotency‑Key avoid reprocessing.
- Observability: store change logs; surface coverage metrics (landmarks, headings outline) in review UI.

## Security & Privacy

- Secrets are server‑side only; LLM calls (if any) run on the server.
- Optional PII redaction in ingestion; strict input size limits and rate limits.
- HMAC‑signed requests; domain verification, organization scoping via Clerk Organization ID (`org_id`), and usage rate caps.

## Consequences

- Data model includes `output_kind = 'semantic_html'` and tables/columns for change logs and confidence scores.
- Rollout workflows emphasize review/diff before activation.
- Meta/JSON‑LD generation can live alongside but is not the core.

## Next Steps

- Expand heuristics coverage and add confidence scoring per change.
- Gate LLM suggestions behind a feature flag with schema validation.
- CLI and GitHub Action for batch transforms and reviewable diffs.
- Metrics: semantic coverage, landmark correctness, heading depth, and “fix rate” over time.
